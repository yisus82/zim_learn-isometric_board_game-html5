<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title>Isometric board game</title>
    <script type="module">
      import zim from "https://zimjs.org/cdn/017/zim_game";

      const OBSTACLE = "0";
      const LANTERN = "1";

      new Frame(FIT, 1024, 768, black, dark, ready);

      function startGame() {
        const board = new Board({
          backgroundColor: grey,
          indicatorBorderColor: light,
        }).center();

        const player = new Person();
        board.add(player, 3, 0);

        board.add(new Tree().alp(.8), 4, 3);
        board.add(new Tree().alp(.8), 5, 7);
        board.add(new Tree(), 0, 5);
        board.add(new Tree(), 5, 0);

        const correctColors = series(pink, red, blue, yellow, green).shuffle();
        new Tile(new Circle(20, correctColors), 5, 1, 10)
          .pos(40, 40, RIGHT, BOTTOM);
        new Label("To pass, reveal the orbs in this order", 40, null, purple)
          .loc(70, 690);

        const colors = shuffle(correctColors.array);
        const lanternPositions = [[1, 1], [5, 2], [6, 6], [2, 7], [3, 4]];
        loop(colors, (color, i) => {
          const cover = new Rectangle(70, 70, silver);
          const lantern = new Container(cover.width, cover.height);
          cover.addTo(lantern);
          lantern.reg(CENTER, lantern.height - 30).sca(.5);
          lantern.cover = cover;
          lantern.orb = new Orb(cover.width * .3, color);
          board.add(lantern, lanternPositions[i][0], lanternPositions[i][1], LANTERN);
        });

        const obstaclePositions = [
          [2, 0], [2, 1],
          [1, 2], [2, 2], [1, 3],
          [3, 6], [4, 6], [3, 7], [4, 7],
          [4, 3], [5, 3], [4, 4], [5, 4],
          [4, 0], [5, 0], [6, 0], [7, 0], [7, 1], [7, 2], [7, 3], [7, 4],
          [0, 5], [0, 6], [0, 7],
          [5, 7], [6, 7], [7, 7], [7, 6]
        ];

        loop(obstaclePositions, obstaclePosition => {
          const tile = board.getTile(obstaclePosition[0], obstaclePosition[1]);
          board.setColor(tile, dark);
          board.setData(tile, OBSTACLE);
        });
      }

      function ready() {
        new Pane({
          content: new Label("Welcome clever traveler!", 70, null, yellow).noMouse(),
          backgroundColor: purple,
        }).show(startGame);
      }
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>

  <body></body>

</html>